// Base CSS shared by all pages (minified)
const BASE_CSS = `:root{--bg-dark:#0d0d0d;--bg-card:#1a1a1a;--bg-elevated:#252525;--accent:#ff9900;--accent-hover:#ffad33;--text:#e5e5e5;--text-muted:#888;--border:#333}*{box-sizing:border-box}body{font-family:"Segoe UI",system-ui,-apple-system,sans-serif;margin:0;padding:0;background:var(--bg-dark);color:var(--text);min-height:100vh}a{color:var(--text);text-decoration:none}a:hover{color:var(--accent)}.main-header{background:var(--bg-dark);border-bottom:1px solid var(--border);padding:0 24px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}.main-header .logo a{color:#fff;font-size:1.5rem;font-weight:800}.main-header .logo a:hover{color:var(--accent)}.header-search{display:flex;align-items:center;gap:8px;flex:1;max-width:420px;margin:0 24px}.header-search input{flex:1;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;padding:8px 14px;color:var(--text);font-size:.95rem}.header-search input::placeholder{color:var(--text-muted)}.header-search input:focus{outline:none;border-color:var(--accent)}.header-search button{background:var(--accent);color:#000;border:none;padding:8px 16px;border-radius:4px;font-weight:600;cursor:pointer}.header-search button:hover{background:var(--accent-hover)}.main-header nav{display:flex;align-items:center;gap:8px}.main-header nav a{color:var(--text-muted);font-size:.9rem;font-weight:500;padding:8px 14px;border-radius:4px}.main-header nav a:hover{color:#fff;background:var(--bg-elevated)}.main-header .btn-upload{background:var(--accent);color:#000;font-weight:700;padding:8px 18px;border-radius:4px}.main-header .btn-upload:hover{background:var(--accent-hover)}.main-content{max-width:1600px;margin:0 auto;padding:24px}.hero{text-align:center;padding:48px 24px;background:linear-gradient(180deg,var(--bg-elevated) 0%,var(--bg-dark) 100%);border-radius:8px;margin-bottom:24px;border:1px solid var(--border)}.hero h1{font-size:2rem;margin:0 0 8px;color:#fff}.hero p{font-size:1rem;color:var(--text-muted);margin:0}.main-footer{background:var(--bg-dark);border-top:1px solid var(--border);text-align:center;padding:20px;margin-top:40px;color:var(--text-muted);font-size:.85rem}.animate-in{opacity:0;transform:translateY(12px);animation:animateIn .4s ease forwards}.delay-1{animation-delay:.08s}.delay-2{animation-delay:.16s}.delay-3{animation-delay:.24s}.delay-4{animation-delay:.32s}.delay-5{animation-delay:.4s}@keyframes animateIn{to{opacity:1;transform:translateY(0)}}.categories-section{margin-bottom:32px}.categories-section h2{font-size:1.2rem;color:#fff;margin:0 0 16px;font-weight:600}.category-tags{display:flex;flex-wrap:wrap;gap:10px}.category-tags a{display:inline-flex;align-items:center;gap:6px;background:var(--bg-elevated);color:var(--text);padding:10px 16px;border-radius:6px;font-size:.95rem;border:1px solid var(--border);transition:background .2s,border-color .2s,color .2s}.category-tags a:hover{background:var(--accent);color:#000;border-color:var(--accent)}.category-tags a span{color:var(--text-muted);font-size:.85rem}.upload-page{max-width:520px;margin:0 auto;padding:24px}.upload-video{padding:24px;background:var(--bg-card);border:1px solid var(--border);border-radius:8px}.upload-video h2{color:#fff;margin-bottom:20px}.upload-form label{display:block;margin-bottom:6px;font-weight:600;color:var(--text)}.upload-form input{margin-bottom:16px;padding:12px;width:100%;border:1px solid var(--border);border-radius:4px;background:var(--bg-dark);color:var(--text);box-sizing:border-box}.upload-form .btn{margin-top:8px}.upload-status{margin-top:16px;padding:12px;border-radius:4px}.upload-status.uploading{background:rgba(255,153,0,.15);color:var(--accent)}.upload-status.success{background:rgba(0,200,100,.2);color:#4ade80}.upload-status.error{background:rgba(239,68,68,.2);color:#f87171}.btn{padding:10px 16px;border-radius:4px;border:none;cursor:pointer;font-size:.9rem;display:inline-flex;align-items:center;gap:8px;background:var(--bg-elevated);color:var(--text);transition:background .2s}.btn-primary{background:var(--accent);color:#000;font-weight:600}.profile-page{max-width:1000px;margin:0 auto;padding:24px}.profile-hero{margin-bottom:32px}.profile-banner{height:180px;background:linear-gradient(135deg,var(--bg-elevated) 0%,var(--accent) 50%,#e68a00 100%);border-radius:8px;opacity:.9}.profile-card{position:relative;margin-top:-60px;margin-left:24px;display:flex;flex-wrap:wrap;align-items:center;gap:20px;padding:24px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);box-shadow:0 4px 20px rgba(0,0,0,.3)}.profile-name{margin:0;font-size:1.5rem;color:#fff}.profile-bio{margin:8px 0 0;color:var(--text-muted);max-width:400px}.profile-avatar{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#e68a00);display:flex;align-items:center;justify-content:center;color:#000;font-weight:bold;font-size:1.2rem}.profile-avatar-large{width:96px;height:96px;font-size:2.5rem}.profile-videos-section h2{margin-bottom:16px;color:#fff}.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}.video-card{background:var(--bg-card);border-radius:6px;overflow:hidden;border:1px solid var(--border);transition:transform .2s,box-shadow .2s}.video-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.4);border-color:var(--accent)}.video-card-thumb{aspect-ratio:16/9;background:#000;overflow:hidden}.video-card-thumb video,.video-card-thumb img{width:100%;height:100%;object-fit:cover}.video-card .video-card-info{padding:12px}.video-card h3{margin:0 0 6px;font-size:.95rem;font-weight:600;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;color:#fff}.video-card-meta{font-size:.8rem;color:var(--text-muted)}.watch-layout{display:grid;grid-template-columns:1fr 380px;gap:24px;max-width:1600px;margin:0 auto;padding:24px}@media(max-width:1100px){.watch-layout{grid-template-columns:1fr}}.video-container{background:#000;border-radius:6px;overflow:hidden;aspect-ratio:16/9}.video-container video{width:100%;height:100%;object-fit:contain}.video-container iframe{width:100%;height:100%;min-height:400px;border:none}.video-info{margin-top:16px}.video-title{font-size:1.35rem;margin:0 0 8px;color:#fff;font-weight:600}.video-stats{color:var(--text-muted);font-size:.9rem;margin-bottom:12px}.video-stats .dot{margin:0 8px;opacity:.6}.action-bar{display:flex;gap:12px;flex-wrap:wrap}.channel-block{display:flex;align-items:center;padding:16px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);margin:16px 0}.channel-link{display:flex;align-items:center;gap:16px;color:inherit}.channel-link:hover{color:var(--accent)}.channel-name{font-weight:600;color:#fff}.channel-label{font-size:.85rem;color:var(--text-muted)}.description-box{margin:16px 0}.description-box h3{margin-bottom:8px;font-size:1rem;color:#fff}.description-box p{color:var(--text-muted);line-height:1.5;margin:0}.comments-section{margin-top:24px}.comments-section h3{margin-bottom:16px;color:#fff;font-size:1rem}.comment-form-wrap{display:flex;gap:12px;align-items:flex-start;margin-bottom:24px}.comment-form{flex:1;display:flex;gap:8px;flex-wrap:wrap}.comment-form input{flex:1;min-width:200px;padding:10px 14px;border:1px solid var(--border);border-radius:4px;font-size:.95rem;background:var(--bg-card);color:var(--text)}.comment-form input::placeholder{color:var(--text-muted)}.comment-item{display:flex;gap:12px;margin-bottom:20px;padding:8px 0}.comment-body{flex:1}.comment-author{font-weight:600;margin-right:8px;color:#fff}.comment-time{font-size:.8rem;color:var(--text-muted)}.comment-text{margin:6px 0 0;line-height:1.4;color:var(--text)}.comment-avatar-small{width:40px;height:40px;font-size:1rem}.watch-sidebar{padding-left:0}.sidebar-title{margin-bottom:12px;font-size:1rem;color:#fff;font-weight:600}.suggested-list{display:flex;flex-direction:column;gap:10px}.suggested-card{display:flex;gap:12px;color:inherit;padding:6px 0;border-radius:4px;transition:background .2s}.suggested-card:hover{background:var(--bg-elevated)}.suggested-thumb{width:168px;height:94px;flex-shrink:0;background:#000;border-radius:4px;overflow:hidden}.suggested-thumb video{width:100%;height:100%;object-fit:cover}.suggested-info{display:flex;flex-direction:column;justify-content:center;min-width:0}.suggested-title{font-weight:500;font-size:.9rem;color:#fff;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.suggested-meta{font-size:.8rem;color:var(--text-muted);margin-top:4px}.open-external-btn{display:inline-block;margin-top:8px;padding:10px 18px;background:var(--accent);color:#000;font-weight:600;border-radius:6px;font-size:.9rem}.open-external-btn:hover{background:var(--accent-hover);color:#000}.btn-like .icon{font-size:1.1rem}.btn.liked{background:var(--accent);color:#000}@media(max-width:768px){.main-header{flex-wrap:wrap;padding:12px 16px;height:auto}.header-search{order:3;flex:1 1 100%;max-width:100%;margin:12px 0 0}.main-content{padding:16px}.hero{padding:24px 16px}.hero h1{font-size:1.5rem}.video-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}.suggested-thumb{width:120px;height:68px}.profile-card{margin-left:16px;padding:20px 16px}.profile-banner{height:140px}.upload-page,.profile-page{padding:16px}.comment-form input{min-width:100%}}@media(max-width:480px){.video-grid{grid-template-columns:1fr}}`;

const NAV = `<header class="main-header"><div class="logo"><a href="index.html">P hub</a></div><form class="header-search" action="index.html" method="GET"><input type="search" name="q" placeholder="Search videos..." autocomplete="off"><button type="submit" aria-label="Search">Search</button></form><nav><a href="index.html">Home</a><a href="categories.html">Categories</a><span id="navAuth"><a href="login.html">Login</a><a href="signup.html">Sign up</a></span><a href="upload.html" class="btn-upload">Upload</a></nav></header>`;

const AUTH_SCRIPT = `(function(){const API=window.location.origin;const KEY="phub_token";const tok=localStorage.getItem(KEY);const nav=document.getElementById("navAuth");if(!nav)return;function setLoggedOut(){nav.innerHTML='<a href="login.html">Login</a><a href="signup.html">Sign up</a>';}function setLoggedIn(){nav.innerHTML='<a href="profile.html">Profile</a><a href="#" id="logoutBtn">Logout</a>';document.getElementById("logoutBtn")?.addEventListener("click",e=>{e.preventDefault();localStorage.removeItem(KEY);location.reload();});}if(!tok){setLoggedOut();return}fetch(API+"/api/auth/me",{headers:{"Authorization":"Bearer "+tok}}).then(r=>{if(r.ok){setLoggedIn();window.phubToken=tok}else{localStorage.removeItem(KEY);setLoggedOut();}}).catch(()=>{localStorage.removeItem(KEY);setLoggedOut();});})();`;

module.exports = {
  categories: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Categories - P hub</title><style>${BASE_CSS}</style></head><body>${NAV}<script>${AUTH_SCRIPT}</script><main class="main-content"><section class="hero"><h1>Categories</h1><p>Explore different categories of videos.</p></section><section class="categories-section"><h2>Popular Categories</h2><div class="category-tags"><a href="index.html?q=japanese">Japanese <span>4.03M</span></a><a href="index.html?q=asian">Asian <span>6.37M</span></a><a href="index.html?q=hot%20mom">Hot Mom <span>11.6M</span></a><a href="index.html?q=perfect%20body">Perfect Body <span>392K</span></a><a href="index.html?q=indian">Indian <span>785K</span></a><a href="index.html?q=mom">Mom <span>12.2M</span></a><a href="index.html?q=chinese">Chinese <span>146K</span></a><a href="index.html?q=beauty">Beauty <span>11.4M</span></a><a href="index.html?q=tamil">Tamil <span>104K</span></a><a href="index.html?q=viral">Viral <span>41.3K</span></a></div></section><section class="categories-section"><h2>Popular Pornstars</h2><div class="category-tags"><a href="index.html?q=johnny%20sins">Johnny Sins</a><a href="index.html?q=angela%20white">Angela White</a><a href="index.html?q=lisa%20ann">Lisa Ann</a><a href="index.html?q=nicole%20aniston">Nicole Aniston</a><a href="index.html?q=lana%20rhoades">Lana Rhoades</a></div></section><section class="categories-section"><h2>Popular Searches</h2><div class="category-tags"><a href="index.html?q=stepmom">Stepmom</a><a href="index.html?q=ai">AI</a><a href="index.html?q=onlyfans">OnlyFans</a><a href="index.html?q=petite">Petite</a></div></section></main><footer class="main-footer"><p>&copy; <span id="cy"></span> P hub. All Rights Reserved.</p></footer><script>document.getElementById("cy").textContent=new Date().getFullYear();</script></body></html>`,

  upload: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Upload - P hub</title><style>${BASE_CSS}</style></head><body>${NAV}<main class="upload-page"><script>${AUTH_SCRIPT}</script><section class="upload-video animate-in"><h2>Upload your video</h2><form id="uploadForm" class="upload-form"><label for="videoTitle">Title</label><input type="text" id="videoTitle" name="videoTitle" placeholder="Enter video title" required><label for="videoFile">Video file</label><input type="file" id="videoFile" name="videoFile" accept="video/mp4,video/avi,video/mkv" required><button type="submit" class="btn btn-primary">Upload</button></form><div id="uploadStatus" class="upload-status"></div></section></main><footer class="main-footer"><p>&copy; <span id="cy"></span> P hub. All Rights Reserved.</p></footer><script>document.getElementById("cy").textContent=new Date().getFullYear();</script><script>(function(){const API=window.location.origin;const KEY="phub_token";const tok=localStorage.getItem(KEY);if(!tok){location.replace("login.html?redirect="+encodeURIComponent("upload.html"));return}document.getElementById("uploadForm").addEventListener("submit",async(e)=>{e.preventDefault();const s=document.getElementById("uploadStatus");s.textContent="Uploading...";s.className="upload-status uploading";try{const r=await fetch(API+"/api/upload",{method:"POST",headers:{"Authorization":"Bearer "+localStorage.getItem(KEY)},body:new FormData(e.target)});const d=await r.json().catch(()=>({}));if(r.ok){s.textContent="Uploaded! Redirecting...";s.className="upload-status success";setTimeout(()=>{window.location.href="watch.html?id="+d.id},1500)}else{s.textContent=d.error||"Upload failed.";s.className="upload-status error"}}catch(err){s.textContent="Error: "+(err.message||"Could not upload.");s.className="upload-status error"}});})();</script></body></html>`,

  profile: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Profile - P hub</title><style>${BASE_CSS}</style></head><body>${NAV}<main class="profile-page"><script>${AUTH_SCRIPT}</script><div class="profile-hero animate-in"><div class="profile-banner"></div><div class="profile-card"><div class="profile-avatar profile-avatar-large"><span id="profileAvatar">?</span></div><h1 id="profileName" class="profile-name">Loading...</h1><p id="profileBio" class="profile-bio">‚Äî</p></div></div><section class="profile-videos-section animate-in delay-2"><h2 id="profileVideosTitle">Videos</h2><div id="profileVideoGrid" class="video-grid"></div></section></main><footer class="main-footer"><p>&copy; <span id="cy"></span> P hub. All Rights Reserved.</p></footer><script>document.getElementById("cy").textContent=new Date().getFullYear();</script><script>(function(){const API=window.location.origin;const KEY="phub_token";const tok=localStorage.getItem(KEY);const pid=new URLSearchParams(location.search).get("id");function gi(n){return(n||"?").trim().charAt(0).toUpperCase()}function eh(t){const d=document.createElement("div");d.textContent=t;return d.innerHTML}async function load(){try{let r;if(pid){r=await fetch(API+"/api/profile/"+encodeURIComponent(pid));document.getElementById("profileVideosTitle").textContent="Videos";}else{if(!tok){location.replace("login.html?redirect="+encodeURIComponent("profile.html"));return}r=await fetch(API+"/api/profile",{headers:{"Authorization":"Bearer "+tok}});document.getElementById("profileVideosTitle").textContent="Your videos";}if(!r.ok){if(r.status===401){location.replace("login.html?redirect="+encodeURIComponent("profile.html"));return}throw new Error()}const p=await r.json();document.getElementById("profileAvatar").textContent=gi(p.name);document.getElementById("profileName").textContent=p.name;document.getElementById("profileBio").textContent=p.bio||"No bio yet.";const my=p.videos||(await fetch(API+"/api/videos").then(x=>x.json())).filter(v=>v.uploaderId===p.id);const g=document.getElementById("profileVideoGrid");const ts=v=>v.telegramFileId?API+"/api/videos/"+v.id+"/stream":API+"/uploads/"+v.file;g.innerHTML=my.map((v,i)=>'<a href="watch.html?id='+v.id+'" class="video-card animate-in delay-'+(i%5)+'"><div class="video-card-thumb"><video muted preload="metadata" src="'+ts(v)+'#t=1"></video></div><div class="video-card-info"><h3>'+eh(v.title)+'</h3><span class="video-card-meta">'+(v.views||0)+' views</span></div></a>').join("")||"<p>No videos yet. "+(pid?"":"<a href='upload.html'>Upload one</a>.")+"</p>"}catch(e){if(!tok&&!pid){location.replace("login.html?redirect="+encodeURIComponent("profile.html"));return}document.getElementById("profileName").textContent="Profile not found";document.getElementById("profileVideoGrid").innerHTML="<p>Could not load profile.</p>"}}if(!pid&&!tok){location.replace("login.html?redirect="+encodeURIComponent("profile.html"));return}else{load();}})();</script></body></html>`,

  watch: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Watch - P hub</title><style>${BASE_CSS}</style></head><body>${NAV}<script>${AUTH_SCRIPT}</script><main class="watch-layout"><div class="watch-main"><div id="ownVideoContainer" class="video-container animate-in"><video id="videoPlayer" controls playsinline><source id="videoSource" src="" type="video/mp4"></video></div><div id="externalVideoContainer" style="display:none"><div class="video-container"><iframe id="externalFrame" src="" allowfullscreen allow="autoplay;fullscreen"></iframe></div><a id="openExternalLink" href="#" target="_blank" class="open-external-btn">Open on original site</a></div><div class="video-info animate-in delay-1"><h1 id="videoTitle" class="video-title">Loading...</h1><div class="video-stats"><span id="videoViews">0 views</span><span class="dot">‚Ä¢</span><span id="videoDate">--</span></div><div class="action-bar"><button type="button" id="likeBtn" class="btn btn-like"><span class="icon">üëç</span><span id="likeCount">0</span></button></div></div><div id="channelBlock" class="channel-block animate-in delay-2"><a href="#" id="channelLink" class="channel-link"><div class="profile-avatar"><span id="uploaderAvatar">?</span></div><div><span id="uploaderName" class="channel-name">Channel</span></div></a></div><div id="descriptionBox" class="description-box animate-in delay-3"><h3>Description</h3><p id="videoDescription">No description.</p></div><section id="commentsSection" class="comments-section animate-in delay-4"><h3><span id="commentsCount">0</span> Comments</h3><div class="comment-form-wrap" id="commentFormWrap"><div class="profile-avatar comment-avatar-small"><span id="commentUserAvatar">?</span></div><form id="commentForm" class="comment-form"><input type="text" id="commentInput" placeholder="Add a comment..." required><button type="submit" class="btn btn-primary">Comment</button></form></div><div id="commentLoginPrompt" style="display:none;margin-bottom:24px;padding:16px;background:var(--bg-elevated);border-radius:8px;color:var(--text-muted)">Log in to add a comment. <a href="login.html?redirect=" id="commentLoginLink">Log in</a></div><div id="commentsList"></div></section></div><aside class="watch-sidebar"><h3 class="sidebar-title">Up next</h3><div id="suggestedVideos" class="suggested-list"></div></aside></main><footer class="main-footer"><p>&copy; <span id="cy"></span> P hub. All Rights Reserved.</p></footer><script>document.getElementById("cy").textContent=new Date().getFullYear();</script><script>(function(){const API=window.location.origin;const g=v=>new URLSearchParams(location.search).get(v);const id=g("id"),ext=g("ext"),title=g("title")||"Video";function fmt(iso){if(!iso)return"--";return new Date(iso).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function gi(n){return(n||"?").trim().charAt(0).toUpperCase()}function eh(t){const d=document.createElement("div");d.textContent=t;return d.innerHTML}function loadExt(){if(!ext)return false;document.getElementById("ownVideoContainer").style.display="none";document.getElementById("channelBlock").style.display="none";document.getElementById("descriptionBox").style.display="none";document.getElementById("commentsSection").style.display="none";const c=document.getElementById("externalVideoContainer");c.style.display="block";document.getElementById("externalFrame").src=API+"/api/embed?url="+encodeURIComponent(ext);document.getElementById("openExternalLink").href=ext;document.getElementById("videoTitle").textContent=decodeURIComponent(title);document.querySelector(".video-stats").style.display="none";document.querySelector(".action-bar").style.display="none";return true}async function loadVid(){if(!id){document.getElementById("videoTitle").textContent="Video not found";return}try{const r=await fetch(API+"/api/videos/"+id);if(!r.ok)throw new Error();const v=await r.json();const src=v.telegramFileId?API+"/api/videos/"+v.id+"/stream":API+"/uploads/"+v.file;document.getElementById("videoSource").src=src;document.getElementById("videoPlayer").load();document.getElementById("videoTitle").textContent=v.title;document.getElementById("videoViews").textContent=(v.views||0)+" views";document.getElementById("videoDate").textContent=fmt(v.createdAt);document.getElementById("likeCount").textContent=v.likes||0;document.getElementById("videoDescription").textContent=v.description||"No description.";document.getElementById("uploaderName").textContent=v.uploaderName||"Unknown";document.getElementById("uploaderAvatar").textContent=gi(v.uploaderName);document.getElementById("channelLink").href=(v.uploaderId?"profile.html?id="+encodeURIComponent(v.uploaderId):"profile.html");await fetch(API+"/api/videos/"+id+"/view",{method:"POST"});loadComments(id);loadSuggested(id);document.getElementById("likeBtn").onclick=async()=>{try{const lr=await fetch(API+"/api/videos/"+id+"/like",{method:"POST"});const d=await lr.json();document.getElementById("likeCount").textContent=d.likes;document.getElementById("likeBtn").classList.add("liked")}catch(e){}}}catch(e){document.getElementById("videoTitle").textContent="Video not found"}}async function loadComments(vid){try{const r=await fetch(API+"/api/videos/"+vid+"/comments");const c=await r.json();document.getElementById("commentsCount").textContent=c.length;document.getElementById("commentsList").innerHTML=c.map(x=>'<article class="comment-item"><div class="profile-avatar comment-avatar-small"><span>'+eh(gi(x.authorName))+'</span></div><div class="comment-body"><span class="comment-author">'+eh(x.authorName)+'</span><span class="comment-time">'+fmt(x.createdAt)+'</span><p class="comment-text">'+eh(x.text)+'</p></div></article>').join("")}catch(e){document.getElementById("commentsList").innerHTML="<p>Failed to load comments.</p>"}}async function loadSuggested(cur){try{const r=await fetch(API+"/api/videos");const vids=await r.json();const o=vids.filter(v=>v.id!==cur).slice(0,8);const ts=v=>v.telegramFileId?API+"/api/videos/"+v.id+"/stream":API+"/uploads/"+v.file;document.getElementById("suggestedVideos").innerHTML=o.map(v=>'<a href="watch.html?id='+v.id+'" class="suggested-card"><div class="suggested-thumb"><video muted preload="metadata" src="'+ts(v)+'#t=1"></video></div><div class="suggested-info"><span class="suggested-title">'+eh(v.title)+'</span><span class="suggested-meta">'+(v.uploaderName||"Unknown")+" ‚Ä¢ "+(v.views||0)+" views</span></div></a>").join("")}catch(e){document.getElementById("suggestedVideos").innerHTML="<p>No more videos.</p>"}}document.getElementById("commentForm").onsubmit=async(e)=>{e.preventDefault();const t=document.getElementById("commentInput").value.trim();if(!t||!id)return;const h={"Content-Type":"application/json"};const tok=localStorage.getItem("phub_token");if(tok)h.Authorization="Bearer "+tok;let r;try{r=await fetch(API+"/api/videos/"+id+"/comments",{method:"POST",headers:h,body:JSON.stringify({text:t})});if(!r.ok)throw new Error();const c=await r.json();document.getElementById("commentsList").insertAdjacentHTML("afterbegin",'<article class="comment-item"><div class="profile-avatar comment-avatar-small"><span>'+eh(gi(c.authorName))+'</span></div><div class="comment-body"><span class="comment-author">'+eh(c.authorName)+'</span><span class="comment-time">Just now</span><p class="comment-text">'+eh(c.text)+'</p></div></article>');document.getElementById("commentsCount").textContent=parseInt(document.getElementById("commentsCount").textContent,10)+1;document.getElementById("commentInput").value=""}catch(x){if(r&&r.status===401){document.getElementById("commentFormWrap").style.display="none";const p=document.getElementById("commentLoginPrompt");p.style.display="block";p.querySelector("a").href="login.html?redirect="+encodeURIComponent(location.href);}else{alert("Could not post comment.")}}};const KEY="phub_token";const tok=localStorage.getItem(KEY);if(tok){fetch(API+"/api/auth/me",{headers:{"Authorization":"Bearer "+tok}}).then(r=>r.ok?r.json():{}).then(u=>{if(u){document.getElementById("commentUserAvatar").textContent=gi(u.name)}});}else{document.getElementById("commentFormWrap").style.display="none";const p=document.getElementById("commentLoginPrompt");p.style.display="block";p.querySelector("a").href="login.html?redirect="+encodeURIComponent(location.href);}if(ext){loadExt();return}loadVid();})();</script></body></html>`,

  login: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Login - P hub</title><style>${BASE_CSS}</style><style>.auth-page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}.auth-box{max-width:400px;width:100%;padding:40px;background:var(--bg-card);border:1px solid var(--border);border-radius:12px}.auth-box h1{margin:0 0 8px;font-size:1.5rem;color:#fff}.auth-box p{margin:0 0 24px;color:var(--text-muted)}.auth-box input{width:100%;padding:14px;margin-bottom:16px;background:var(--bg-dark);border:1px solid var(--border);border-radius:8px;color:var(--text);box-sizing:border-box}.auth-box button{width:100%;padding:14px;background:var(--accent);color:#000;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem}.auth-box button:hover{background:var(--accent-hover)}.auth-box .error{color:#f87171;margin-top:12px;font-size:.9rem}.auth-box .link{margin-top:16px;text-align:center}.auth-box .link a{color:var(--accent)}.auth-header{text-align:center;margin-bottom:24px}.auth-header a{color:var(--text-muted);font-size:.9rem}</style></head><body><header class="main-header"><div class="logo"><a href="index.html">P hub</a></div><nav><a href="index.html">‚Üê Home</a></nav></header><main class="auth-page"><div class="auth-box animate-in"><h1>Log in</h1><p>Sign in to upload, comment, and manage your profile.</p><form id="loginForm"><input type="email" name="email" placeholder="Email" required><input type="password" name="password" placeholder="Password" required><button type="submit">Log in</button><p id="loginError" class="error"></p><p class="link">Don't have an account? <a href="signup.html">Sign up</a></p></form></div></main><script>(function(){const API=window.location.origin;const KEY="phub_token";const red=()=>{const p=new URLSearchParams(location.search);return p.get("redirect")||"index.html"};fetch(API+"/api/auth/me",{headers:{"Authorization":"Bearer "+localStorage.getItem(KEY)}}).then(r=>{if(r.ok)location.replace(red());}).catch(()=>{});document.getElementById("loginForm").onsubmit=async(e)=>{e.preventDefault();const err=document.getElementById("loginError");err.textContent="";const fd=new FormData(e.target);try{const r=await fetch(API+"/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:fd.get("email"),password:fd.get("password")})});const d=await r.json().catch(()=>({}));if(r.ok){localStorage.setItem(KEY,d.token);location.replace(red())}else{err.textContent=d.error||"Login failed."}}catch(x){err.textContent="Network error. Try again."}};})();</script></body></html>`,

  signup: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Sign up - P hub</title><style>${BASE_CSS}</style><style>.auth-page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}.auth-box{max-width:400px;width:100%;padding:40px;background:var(--bg-card);border:1px solid var(--border);border-radius:12px}.auth-box h1{margin:0 0 8px;font-size:1.5rem;color:#fff}.auth-box p{margin:0 0 24px;color:var(--text-muted)}.auth-box input{width:100%;padding:14px;margin-bottom:16px;background:var(--bg-dark);border:1px solid var(--border);border-radius:8px;color:var(--text);box-sizing:border-box}.auth-box button{width:100%;padding:14px;background:var(--accent);color:#000;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1rem}.auth-box button:hover{background:var(--accent-hover)}.auth-box .error{color:#f87171;margin-top:12px;font-size:.9rem}.auth-box .link{margin-top:16px;text-align:center}.auth-box .link a{color:var(--accent)}.auth-header{text-align:center;margin-bottom:24px}.auth-header a{color:var(--text-muted);font-size:.9rem}</style></head><body><header class="main-header"><div class="logo"><a href="index.html">P hub</a></div><nav><a href="index.html">‚Üê Home</a></nav></header><main class="auth-page"><div class="auth-box animate-in"><h1>Sign up</h1><p>Create an account to upload videos and comment.</p><form id="signupForm"><input type="text" name="name" placeholder="Display name" required><input type="email" name="email" placeholder="Email" required><input type="password" name="password" placeholder="Password (min 6 chars)" required minlength="6"><button type="submit">Create account</button><p id="signupError" class="error"></p><p class="link">Already have an account? <a href="login.html">Log in</a></p></form></div></main><script>(function(){const API=window.location.origin;const KEY="phub_token";const red=()=>{const p=new URLSearchParams(location.search);return p.get("redirect")||"index.html"};fetch(API+"/api/auth/me",{headers:{"Authorization":"Bearer "+localStorage.getItem(KEY)}}).then(r=>{if(r.ok)location.replace(red());}).catch(()=>{});document.getElementById("signupForm").onsubmit=async(e)=>{e.preventDefault();const err=document.getElementById("signupError");err.textContent="";const fd=new FormData(e.target);try{const r=await fetch(API+"/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:fd.get("name"),email:fd.get("email"),password:fd.get("password")})});const d=await r.json().catch(()=>({}));if(r.ok){localStorage.setItem(KEY,d.token);location.replace(red())}else{err.textContent=d.error||"Sign up failed."}}catch(x){err.textContent="Network error. Try again."}};})();</script></body></html>`,

  admin: `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Admin - P hub</title><style>${BASE_CSS}</style><style>.hidden{display:none!important}body.admin-page{background:#0f0f0f;color:#e5e5e5}.admin-login-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}.admin-login{max-width:400px;padding:40px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:16px}.admin-login h1{margin:0 0 8px;font-size:1.5rem;color:#fff}.admin-login input{width:100%;padding:14px;margin-bottom:16px;background:#0f0f0f;border:1px solid #2a2a2a;border-radius:10px;color:#e5e5e5;box-sizing:border-box}.admin-login button{width:100%;padding:14px;background:#ff9900;color:#000;border:none;border-radius:10px;font-weight:600;cursor:pointer}.admin-wrap{max-width:1200px;margin:0 auto;padding:24px}.admin-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:24px;border-bottom:1px solid #2a2a2a}.admin-back{padding:10px 18px;background:#252525;border:1px solid #2a2a2a;border-radius:10px;color:#e5e5e5;text-decoration:none}.admin-back:hover{color:#ff9900}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:32px}.stat-card{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px}.stat-card .value{font-size:2rem;font-weight:800;color:#ff9900}.stat-card .label{font-size:.9rem;color:#888;margin-top:6px}.admin-section{background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px}.admin-section h2{margin:0 0 20px;font-size:1.1rem;color:#fff}.videos-table,.comments-table{width:100%;border-collapse:collapse;font-size:.9rem}.videos-table th,.videos-table td,.comments-table th,.comments-table td{padding:14px;border-bottom:1px solid #2a2a2a;text-align:left}.videos-table a,.comments-table a{color:#ff9900}.telegram-form input{margin-bottom:12px;padding:12px;width:100%;background:#0f0f0f;border:1px solid #2a2a2a;border-radius:10px;color:#e5e5e5;box-sizing:border-box}.admin-btn{padding:10px 18px;border-radius:8px;border:none;font-size:.9rem;cursor:pointer;margin-right:8px;margin-bottom:8px}.admin-btn-primary{background:#ff9900;color:#000}.admin-btn-secondary{background:#252525;color:#e5e5e5;border:1px solid #2a2a2a}.btn-sm{padding:6px 14px;font-size:.85rem;border-radius:6px;border:none;cursor:pointer;background:#ef4444;color:#fff}</style></head><body class="admin-page"><div id="loginScreen" class="admin-login-wrap"><div class="admin-login"><h1>Admin</h1><p style="color:#888;margin-bottom:24px">P hub dashboard</p><input type="password" id="adminPassword" placeholder="Password"><button type="button" id="loginBtn">Log in</button><p id="loginError" class="error hidden" style="color:#f87171;margin-top:12px"></p></div></div><div id="dashboard" class="admin-wrap hidden"><header class="admin-header"><h1>Dashboard</h1><a href="index.html" class="admin-back">‚Üê Back to P hub</a></header><div class="stats-grid"><div class="stat-card"><div class="value" id="statVideos">0</div><div class="label">Videos</div></div><div class="stat-card"><div class="value" id="statViews">0</div><div class="label">Total views</div></div><div class="stat-card"><div class="value" id="statLikes">0</div><div class="label">Total likes</div></div><div class="stat-card"><div class="value" id="statComments">0</div><div class="label">Comments</div></div></div><section class="admin-section"><h2>Connect Telegram</h2><div class="telegram-form"><input type="text" id="tgBotToken" placeholder="Bot Token" value="8410875614:AAGm1an_NLh5FwAwsx27NThUvv3oeTEANPM"><input type="text" id="tgChatId" placeholder="Chat ID" value="5247292298"><select id="tgStoreMode"><option value="download">Save to PC</option><option value="telegram_only">Telegram only</option></select><button type="button" id="tgSave" class="admin-btn admin-btn-primary">Save</button><button type="button" id="tgSync" class="admin-btn admin-btn-secondary">Sync from Telegram</button><button type="button" id="tgCheck" class="admin-btn admin-btn-secondary">Check connection</button><button type="button" id="tgWebhookOn" class="admin-btn admin-btn-primary" title="Videos you post to Telegram will appear automatically">Enable Auto-Import</button><button type="button" id="tgWebhookOff" class="admin-btn admin-btn-secondary">Disable Auto-Import</button><span id="tgStatus" style="display:block;margin-top:8px;color:#888;font-size:.9rem"></span><p style="margin-top:16px;padding:12px;background:rgba(255,153,0,.1);border-radius:8px;font-size:.9rem;color:#ffad33"><strong>Tip:</strong> Use the same URL for admin and viewing (e.g. yoursite.vercel.app). If you sync on localhost, mobile won't see videos. Prefer <strong>Telegram only</strong> on Vercel‚Äîvideos stream from Telegram to all devices.</p></div></section><section class="admin-section"><h2>Videos</h2><div style="overflow-x:auto"><table class="videos-table"><thead><tr><th>Title</th><th>Views</th><th>Likes</th><th>Date</th><th></th></tr></thead><tbody id="videosBody"></tbody></table></div></section><section class="admin-section"><h2>Comments</h2><div style="overflow-x:auto"><table class="comments-table"><thead><tr><th>Video</th><th>Author</th><th>Comment</th><th></th></tr></thead><tbody id="commentsBody"></tbody></table></div></section></div><script>(function(){const API=window.location.origin;let sec="";const h=()=>({"Content-Type":"application/json",Authorization:"Bearer "+sec});async function api(path,o={}){const r=await fetch(API+path,{...o,headers:{...o.headers,...h()}});const d=await r.json().catch(()=>({}));if(!r.ok)throw new Error(d.error||r.statusText);return d}function show(e){e.classList.remove("hidden")}function hide(e){e.classList.add("hidden")}function eh(t){const d=document.createElement("div");d.textContent=t==null?"":t;return d.innerHTML}document.getElementById("loginBtn").onclick=async()=>{sec=document.getElementById("adminPassword").value.trim();const err=document.getElementById("loginError");if(!sec){err.textContent="Enter password.";show(err);return}hide(err);try{const r=await fetch(API+"/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:sec})});const d=await r.json().catch(()=>({}));if(!r.ok){err.textContent=d.error||"Invalid password.";show(err);return}hide(document.getElementById("loginScreen"));show(document.getElementById("dashboard"));loadDash()}catch(e){err.textContent="Invalid password or server not running.";show(err)}};document.getElementById("adminPassword").onkeydown=e=>{if(e.key==="Enter")document.getElementById("loginBtn").click()};async function loadStats(){try{const s=await api("/api/admin/stats");document.getElementById("statVideos").textContent=s.videosCount;document.getElementById("statViews").textContent=s.totalViews;document.getElementById("statLikes").textContent=s.totalLikes;document.getElementById("statComments").textContent=s.totalComments}catch(e){}}async function loadTg(){try{const t=await api("/api/admin/telegram");document.getElementById("tgChatId").value=t.chatId||"5247292298";document.getElementById("tgStoreMode").value=t.storeMode||"download";document.getElementById("tgBotToken").value=t.connected?"":"8410875614:AAGm1an_NLh5FwAwsx27NThUvv3oeTEANPM";document.getElementById("tgStatus").textContent=t.connected?"Connected.":"Set Bot Token and Chat ID, then Save."}catch(e){document.getElementById("tgStatus").textContent="Could not load."}}async function loadVids(){const tb=document.getElementById("videosBody");try{const list=await api("/api/admin/videos");tb.innerHTML=list.length===0?"<tr><td colspan=5>No videos.</td></tr>":list.map(v=>'<tr><td><a href="watch.html?id='+eh(v.id)+'">'+eh(v.title)+'</a></td><td>'+(v.views||0)+'</td><td>'+(v.likes||0)+'</td><td>'+new Date(v.createdAt).toLocaleDateString()+'</td><td><button class="btn-sm" data-id="'+eh(v.id)+'">Delete</button></td></tr>').join("");tb.querySelectorAll(".btn-sm").forEach(b=>{b.onclick=async()=>{if(!confirm("Delete?"))return;try{await api("/api/admin/videos/"+b.dataset.id,{method:"DELETE"});loadVids();loadStats()}catch(e){alert(e.message)}}})}catch(e){tb.innerHTML="<tr><td colspan=5>Failed.</td></tr>"}}async function loadCom(){const tb=document.getElementById("commentsBody");try{const list=await api("/api/admin/comments");tb.innerHTML=list.length===0?"<tr><td colspan=4>No comments.</td></tr>":list.map(c=>'<tr><td><a href="watch.html?id='+eh(c.videoId)+'">'+eh(c.videoId)+'</a></td><td>'+eh(c.authorName)+'</td><td>'+eh(c.text).slice(0,80)+(c.text.length>80?"‚Ä¶":"")+'</td><td><button class="btn-sm" data-vid="'+eh(c.videoId)+'" data-cid="'+eh(c.id)+'">Delete</button></td></tr>').join("");tb.querySelectorAll(".btn-sm").forEach(b=>{b.onclick=async()=>{if(!confirm("Delete?"))return;try{await api("/api/admin/comments/"+b.dataset.vid+"/"+b.dataset.cid,{method:"DELETE"});loadCom();loadStats()}catch(e){alert(e.message)}}})}catch(e){tb.innerHTML="<tr><td colspan=4>Failed.</td></tr>"}}document.getElementById("tgSave").onclick=async()=>{try{await api("/api/admin/telegram",{method:"POST",body:JSON.stringify({chatId:document.getElementById("tgChatId").value.trim(),storeMode:document.getElementById("tgStoreMode").value,botToken:document.getElementById("tgBotToken").value.trim()||undefined})});document.getElementById("tgStatus").textContent="Saved.";loadTg()}catch(e){document.getElementById("tgStatus").textContent=e.message}};document.getElementById("tgSync").onclick=async()=>{const btn=document.getElementById("tgSync");btn.disabled=true;try{const d=await api("/api/admin/telegram-sync",{method:"POST"});document.getElementById("tgStatus").textContent="Synced: "+d.added+" new video(s).";loadVids();loadStats()}catch(e){document.getElementById("tgStatus").textContent=e.message}btn.disabled=false};document.getElementById("tgCheck").onclick=async()=>{try{const d=await api("/api/admin/telegram-check");document.getElementById("tgStatus").textContent="Found "+d.totalUpdates+" update(s) from "+d.chats.length+" chat(s)."}catch(e){document.getElementById("tgStatus").textContent="Error: "+e.message}};document.getElementById("tgWebhookOn").onclick=async()=>{try{const d=await api("/api/admin/telegram-webhook-enable",{method:"POST"});document.getElementById("tgStatus").textContent="Auto-import enabled! Post videos to your group and they'll appear on the site.";}catch(e){document.getElementById("tgStatus").textContent=e.message}};document.getElementById("tgWebhookOff").onclick=async()=>{try{await api("/api/admin/telegram-webhook-disable",{method:"POST"});document.getElementById("tgStatus").textContent="Auto-import disabled. Use Sync from Telegram for manual import.";}catch(e){document.getElementById("tgStatus").textContent=e.message}};function loadDash(){loadStats();loadTg();loadVids();loadCom()}})();</script></body></html>`,
};
